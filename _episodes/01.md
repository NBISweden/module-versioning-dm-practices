---
title: "Version control systems"
teaching: 20
exercises: 10
objectives:
- Get a mental representation of version control and its benefits.
- Understand the difference between Git and GitHub.
keypoints:
- Use a version control system to manage snapshots of your data, scripts, documents,
  manuscripts and more!
- Creating snapshots allow you to go back to the same version as was published, shared
  with a collaborator or used in an analysis
- Keeping a record of changes allows you track down problems and selectively undo/redo
questions:
- How not to worry about making changes to a project?
- What is version control?
- What is Git and GitHub?
---

> ### Introduction to the lesson
> This module is divided into four sections and is designed to offer a brief yet practical introduction to version control, Git, and GitHub. 
> The opening section presents the basic theory of version control, including an explanation of the relationship between Git and GitHub. 
> The second section offers guidance on how to initiate version control on your local computer. 
> The third section demonstrates remote versioning and the web interface on GitHub. 
> Lastly, the fourth section includes practical examples on how to connect local version control on your computer with remote version control on the web.
>
> **This tutorial avoids using the command line.** Instead, we will practice version control using Git in RStudio. We will also introduce GitHub and show how the website can be used. Later on, we will practise how to manage a local git repository together with the remote repository on GitHub. In many cases, this is enough. Git in Rstudio and GitHub provide collaboration tools to all kinds of projects, and there are all kinds of good ways to use it.
>
> This tutorial serves as an introduction to version control and Git. After this lesson, you will both be able to use Git, and feel much more confident taking a command-line Git course such as [CodeRefinery’s git-intro course](https://coderefinery.github.io/git-intro/). 
>
> What we will not cover:
>
> * Command line interface
> * Cloning using SSH protocol and SSH keys
> * Rebasing and squashing
> * Many Git tricks which can be explored later
{: .callout}

> ## Why GitHub?
>
> We will do an exercise on [GitHub](https://github.com) but also
> [GitLab](https://gitlab.com) and [Bitbucket](https://bitbucket.org) allow
> similar workflows and basically everything that we will discuss is transferable. With
> this material and these exercises we do not endorse the company
> [GitHub](https://github.com). We have chosen to demonstrate a number of
> concepts using examples with [GitHub](https://github.com) because it is
> currently the most popular web platform for hosting Git repositories and the chance is high
> that you will interact with [GitHub](https://github.com)-based repositories even if you
> choose to host your Git repository on another platform.
>
> We also encourage course participants to use CodeRefinery’s [Nordic research software repository platform](https://source.coderefinery.org),
> for more information see [https://coderefinery.org/repository/](https://coderefinery.org/repository/).
{: .solution}

> ## Exercise 1: Problems with change (5 min)
>
> Let us start with a small exercise to get you activated. 
> Which of the following issues can you relate to? 
> If you want, discuss it with your neighbour and save your answers for later. 
> 
> * Which version of this file should I use? I have eight different versions.
> * I can’t recreate this figure from last year - I don't remember how I did it.
> * After making a slight modification to my code in one place, everything stopped working.
> * I have multiple copies of the same directory because I'm worried about breaking something.
> * Someone added erroneous records in a shared file with samples, and I can't figure out who or why.
> * I remember seeing a data file, but now I can't find it. Was it deleted or moved?
> * I tried multiple analyses, but I can't remember which one I chose to generate my output data.
> * I need to merge changes to our manuscript from 7 different emails with collaborators.
> * I accidentally deleted a part of my work
> * I came back to an old project and forgot where I left/saved it.
> * I reorganized my data files, but broke the analysis pipeline and now I don't know how to fix it
> * I'm having trouble finding the source of a mistake in an experiment.
> * My directory is polluted with a lot of unused/temporary/old folders because I'm afraid of losing something important
> * I made a lot of changes to my paper, but I want to bring back one paragraph.
{: .challenge}

![Figure 1. Versioning Hell](../fig/basics/ew-versions.png)  
*"Piled Higher and Deeper" by Jorge Cham (http://phdcomics.com/)*

## Introduction to Version Control

When making changes to files and their content, we risk losing previous content or entire files by overwriting them, hoping they will not be needed. Additionally, there may be unintended side effects, such as breaking analysis pipelines when renaming files. It can also be challenging to manage multiple changes across different files as a cohesive unit, such as updating a figure and its accompanying description. Furthermore, when collaborating with others, it is necessary to coordinate and resolve conflicts arising from concurrent changes made by collaborators.

Addressing these issues by tracking changes is called **version control**.

> ### How Version Control Systems Work
> 
> Version control systems (VCS) are software tools that help manage changes to files and documents over time. 
> They work by keeping track of different versions of a file, allowing users to switch between different versions and merge changes made by multiple users.
> 
> 1. VCS maintain a repository that stores all versions of files, along with metadata such as the author, timestamp, and a unique identifier for each version.
> 2. When a user makes changes to a file, the VCS creates a new version, rather than overwriting the existing one. 
> This preserves the history of changes made to the file.
> 3. VCS provide features like branching and merging, which allow users to create separate lines of development (branches) for different tasks or features, 
> and then merge them back into the main branch when they are ready.
> 4. VCS also enable users to compare different versions of a file, track changes made by different users, and revert to previous versions if needed.
> 5. VCS facilitate collaboration among multiple users by providing mechanisms for resolving conflicts that may arise when two or more users make changes to the same file simultaneously.
>
> Overall, VCS provide a systematic and organized approach to managing changes to files, 
> enabling efficient collaboration, and preserving the history of changes made to a project. 
{: .callout}

### Version Control Systems vs. Manual Versioning

To highlight some benefits of version control systems over manual version
control:

* Instead of mandating users to create backups of the entire project, 
version control systems securely stores only the necessary information 
to recreate previous versions of files on demand.

* Instead of depending on users to come up with meaningful names for backup copies, 
the version control system automatically timestamps all saved changes, 
ensuring efficient tracking and organization of revisions.

* Instead of requiring users to consistently update a changelog, 
version control systems prompt users to document changes 
every time a modification is saved. They also keep a 100% accurate record of what was
*actually* changed, as opposed to what the user *thought* they
changed. This can be immensely valuable for troubleshooting and issue resolution when problems crop up later.

* Instead of blindly copying files to remote storage, 
version control systems perform conflict checks to ensure that no one's work will be overwritten. 
If conflicts are detected, they are identified, making it easier to resolve and merge changes.

---

### What is Git and GitHub?

To put it simply, **Git** is a version control system and a program that you install on your computer, like Word, which helps you keep track of changes in files. It acts like a virtual folder called a repository where all changes are stored as snapshots, also known as commits.

On the other hand, **GitHub** is a web-based hosting service for Git repositories. It provides a platform for collaborative software development, where you can store and manage your Git repositories online. GitHub acts as a remote repository that can communicate with your local Git repository, allowing you to push changes from your local repository to GitHub and pull changes from GitHub to your local repository. It also provides additional features such as issue tracking, code reviews, and collaboration tools, making it popular among developers for hosting and sharing their work with others. Just like OneDrive can synchronize Word documents across multiple devices, GitHub can propagate changes made in Git repositories across different computers and provide a centralized location for collaboration and version control in a group setting.

**In research**, it is vital to keep track of changes made to data and software by you or your collaborators. This allows you to easily reference or retrieve a specific version of the entire project, which promotes reproducibility. This becomes especially important during various stages of the research process, such as leading up to publication, addressing reviewer comments, and providing information to reviewers, editors, and readers. Keeping a record of changes made ensures that the research findings can be validated, collaborated upon, and documented accurately, enhancing the reliability and transparency of the research work.

> ## Exercise 2: Using Version Control System (5 min)
>
> As you now have been introduced to version control systems, we invite you to consider these five reasons for incorporating a version control system into your research workflow. 
> Which two are the most important for you?
>
> *   Tell the story: The history of your commit messages will describe your project progress.
> *   Travel back in time: a version control system makes it easy to compare different time points of your project smoothly. If you want to compare the stage of your project a year ago from now, it only takes one command-line of code.
> *   Experiment with changes: if you want to make changes in a script you can first make a “snapshot” of the project status before experimenting with changes.
> *   Backup your work: by being able to link your local repository (folder) to a distant online host (GitHub), a version control system backs up your precious work instantly.
> *   Collaborate easily on projects: having a web-hosted synchronised version of your project will encourage collaboration with other researchers. Think about a colleague of yours being able to add a script to make a figure for your publication for instance.
> The repository will track their contribution and evidence their participation in the project.
>
{: .challenge}

> ## Version Control System and FAIR
> If time allows. Looking at the reasons to use a version control system in research, 
> how does using version control system help in being FAIR?
>
>> ## Solution
>>
>> *   Online respository is a Findable and Accessible resource (also Trackable).
>> *   Online repositories are also interoperable since they can be accessed from anywhere (with internet) and are not restricted to your local hard drive.
>> *   The 'telling story' and being able to travel back in time helps in reuse and reproducibility.
> {: .solution}
{: .challenge}

> ## Attribution
> * A lot of the content in this episode was inspired by [fair-bio-practice](https://carpentries-incubator.github.io/fair-bio-practice/11-version-control/index.html) which in turn was adopted from Wilson et al.
> [Good Enough Practices for Scientific Computing](https://github.com/swcarpentry/good-enough-practices-in-scientific-computing).
>
{: .callout}

---

## Extra Material

### Commits, branches, repositories, forks, clones

- **repository**: The project, contains all data and history (commits, branches, tags).
- **commit**: Snapshot of the project, gets a unique identifier (e.g. `c7f0e8bfc718be04525847fc7ac237f470add76e`).
- **branch**: Independent development line, often we call the main development line `main`.
- **tag**: A pointer to one commit, to be able to refer to it later. Like a sticky note that you attach to a particular commit (e.g. `phd-printed` or `paper-submitted`).
- **cloning**: Copying the whole repository to your laptop - the first time. It is not necessary to download each file one by one.
- **forking**: Taking a copy of a repository (which is typically not yours) - your
  copy (fork) stays on GitHub and you can make changes to your copy.

![fig](../fig/basics/file-view.png)

GitHub file view of the
[nf-core/viralrecon](https://github.com/nf-core/viralrecon/)
repository.  This is the version of all files at a single point in
time.

![fig](../fig/basics/history-demo.png)

Github history view of the
[viralrecon](https://github.com/nf-core/viralrecon/commits/master)
repository.  This is the progression of the repository (with the
**commit message** over time).

![fig](../fig/basics/commits-and-branches.png)

Network graph of all commits in the
[nf-core/viralrecon](https://github.com/nf-core/viralrecon/network)
repository.  This shows the relationship between different **forks**
of people who are contributing and sharing code.

### Interesting repositories to explore these concepts

- Assembly and intrahost/low-frequency variant calling for viral samples
  - Repository: <https://github.com/nf-core/viralrecon/>
  - Commits, branches, forks: <https://github.com/nf-core/viralrecon//network>
- Swedish COVID-19 data portal
  - Repository: <https://github.com/ScilifelabDataCentre/covid-portal>
  - Commits, branches, forks: <https://github.com/ScilifelabDataCentre/covid-portal/network>
- [Activity inequality study](http://activityinequality.stanford.edu/)
  - Contains data and code necessary to create figures from their article.
  - Data: <https://github.com/timalthoff/activityinequality/tree/master/data>
- FiveThirtyEight story [Why We’re Sharing 3 Million Russian Troll Tweets](https://fivethirtyeight.com/features/why-were-sharing-3-million-russian-troll-tweets/)
  - Contains data and readme file, no code.
  - Data: <https://github.com/fivethirtyeight/russian-troll-tweets>
- The NY Times Coronavirus (Covid-19) Data in the United States
  - Contains data, readme, license, but no code.  As of 2020 April,
    being updated every day.
  - Data: <https://github.com/nytimes/covid-19-data>
  - Website: <https://www.nytimes.com/interactive/2020/us/coronavirus-us-cases.html>
- CSV exports of the Getty Provenance Index
  - Data: <https://github.com/thegetty/provenance-index-csv>
- Entire books are written using Git/GitHub:
  - <https://github.com/rust-lang/book>
  - <https://github.com/ropensci/dev_guide>
  - <https://github.com/alan-turing-institute/the-turing-way>
- Papers under open review:
  - <https://github.com/openjournals/joss-reviews/issues>

> ## Why using repositories?
>
> - All changes are recorded.
> - We do not have to send changes via email.
> - We can experiment with several ideas which might not work out (using branches).
> - Several people can work on the same project at the same time (using branches).
> - We do not have to wait for others to send us "the latest version" over email.
> - We do not have to merge parallel developments by hand.
> - Group-based access model where shared access is the default, instead of
>   everything fundamentally owned by individuals who manage sharing as-needed:
>   with Git you can easily have collaboration be the default.
> - It is possible to serve websites directly from a repository.
{: .callout}

> ## Discussion
>
> - How have you solved these in the past without version control?
{: .discussion}
